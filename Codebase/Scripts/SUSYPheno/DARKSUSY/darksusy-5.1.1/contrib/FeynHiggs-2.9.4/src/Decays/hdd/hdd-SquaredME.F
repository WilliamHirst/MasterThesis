*#define CHECK

#if 0
* hdd-SquaredME.F
* assembly of squared matrix element
* generated by FormCalc 7.5 on 27-Sep-2012 9:24
* this file is part of FeynHiggs
#endif

#include "hdd-vars.h"

************************************************************************

	RealType function hdd_sumup(CCloop, CCtree)
	implicit none

#include "hdd-vars.h"

	ComplexType CCloop(1), CCtree(1)
	ComplexType m

	hdd_sumup = 0

	m = 0
	m = m + CCloop(1)*MatSUN(1,1)
	hdd_sumup = hdd_sumup + Re(Conjugate(CCtree(1))*m)
	end

************************************************************************

	subroutine hdd_SquaredMEHel(result)
	implicit none
	RealType result(*)

#include "hdd-vars.h"

	RealType hdd_sumup
	external hdd_sumup

* hdd-BEGIN ABBR_HEL
	call hdd_abbr0hel
	call hdd_abbr1hel
* hdd-END ABBR_HEL

* hdd-BEGIN FF_INI
	Ctree(1) = 0

	Cloop(1) = 0
* hdd-END FF_INI

* hdd-BEGIN FF_TREE
	sub1L = 1

	call hdd_v0

	Cloop(1) = Ctree(1)

	Ctree(1) = 0

	sub1L = 0
	call hdd_v0

	result(1) = result(1) + hdd_sumup(Ctree, Ctree)
* hdd-END FF_TREE

* hdd-BEGIN FF_LOOP
	call hdd_v1

	LOOP(Gen4, 1,3,1)
	call hdd_v1_Gen4
	ENDLOOP(Gen4)

	LOOP(Ind1, 1,3,1)
	LOOP(All4, 1,6,1)
	call hdd_v1_All4_Ind1
	ENDLOOP(All4)
	ENDLOOP(Ind1)

	LOOP(Cha5, 1,2,1)
	LOOP(Cha4, 1,2,1)
	call hdd_v1_Cha4_Cha5
	ENDLOOP(Cha4)
	ENDLOOP(Cha5)

	LOOP(Sfe4, 1,2,1)
	LOOP(Gen4, 1,3,1)
	call hdd_v1_Gen4_Sfe4
	ENDLOOP(Gen4)
	ENDLOOP(Sfe4)

	LOOP(Neu5, 1,4,1)
	LOOP(Neu4, 1,4,1)
	call hdd_v1_Neu4_Neu5
	ENDLOOP(Neu4)
	ENDLOOP(Neu5)

	LOOP(Neu5, 1,4,1)
	LOOP(Neu4, 1,4,1)
	LOOP(All4, 1,6,1)
	call hdd_v1_All4_Neu4_Neu5
	ENDLOOP(All4)
	ENDLOOP(Neu4)
	ENDLOOP(Neu5)

	LOOP(Sfe5, 1,2,1)
	LOOP(Sfe4, 1,2,1)
	LOOP(Gen4, 1,3,1)
	call hdd_v1_Gen4_Sfe4_Sfe5
	ENDLOOP(Gen4)
	ENDLOOP(Sfe4)
	ENDLOOP(Sfe5)

	LOOP(Ind2, 1,3,1)
	LOOP(Ind1, 1,3,1)
	LOOP(All5, 1,6,1)
	LOOP(All4, 1,6,1)
	call hdd_v1_All4_All5_Ind1_Ind2
	ENDLOOP(All4)
	ENDLOOP(All5)
	ENDLOOP(Ind1)
	ENDLOOP(Ind2)

	LOOP(Ind3, 1,3,1)
	LOOP(Ind2, 1,3,1)
	LOOP(Ind1, 1,3,1)
	LOOP(All5, 1,6,1)
	LOOP(All4, 1,6,1)
	call hdd_v1_All4_All5_Ind1_Ind2Ind3
	ENDLOOP(All4)
	ENDLOOP(All5)
	ENDLOOP(Ind1)
	ENDLOOP(Ind2)
	ENDLOOP(Ind3)

	LOOP(Neu4, 1,4,1)
	LOOP(Ind2, 1,3,1)
	LOOP(Ind1, 1,3,1)
	LOOP(All5, 1,6,1)
	LOOP(All4, 1,6,1)
	call hdd_v1_All4_All5_Ind1_Ind2Neu4
	ENDLOOP(All4)
	ENDLOOP(All5)
	ENDLOOP(Ind1)
	ENDLOOP(Ind2)
	ENDLOOP(Neu4)

	LOOP(Ind2, 1,3,1)
	LOOP(Ind1, 1,3,1)
	LOOP(Cha5, 1,2,1)
	LOOP(Cha4, 1,2,1)
	LOOP(All4, 1,6,1)
	call hdd_v1_All4_Cha4_Cha5_Ind1Ind2
	ENDLOOP(All4)
	ENDLOOP(Cha4)
	ENDLOOP(Cha5)
	ENDLOOP(Ind1)
	ENDLOOP(Ind2)

	LOOP(Ind4, 1,3,1)
	LOOP(Ind3, 1,3,1)
	LOOP(Ind2, 1,3,1)
	LOOP(Ind1, 1,3,1)
	LOOP(All5, 1,6,1)
	LOOP(All4, 1,6,1)
	call hdd_v1_All4All5Ind1Ind2Ind3Id4
	ENDLOOP(All4)
	ENDLOOP(All5)
	ENDLOOP(Ind1)
	ENDLOOP(Ind2)
	ENDLOOP(Ind3)
	ENDLOOP(Ind4)

	LOOP(Ind4, 1,3,1)
	LOOP(Ind3, 1,3,1)
	LOOP(Ind2, 1,3,1)
	LOOP(Ind1, 1,3,1)
	LOOP(Cha4, 1,2,1)
	LOOP(All5, 1,6,1)
	LOOP(All4, 1,6,1)
	call hdd_v1_All4All5Ca4Id1Id2Id3Id4
	ENDLOOP(All4)
	ENDLOOP(All5)
	ENDLOOP(Cha4)
	ENDLOOP(Ind1)
	ENDLOOP(Ind2)
	ENDLOOP(Ind3)
	ENDLOOP(Ind4)

	result(2) = result(2) + 2*hdd_sumup(Cloop, Ctree)
	result(2) = result(2) + hdd_sumup(Cloop, Cloop)
* hdd-END FF_LOOP
	end

************************************************************************

	subroutine hdd_SquaredME(result, helicities)
	implicit none
	RealType result(*)
	integer helicities

#include "hdd-vars.h"

* hdd-BEGIN VARDECL
	external hdd_SquaredMEHel

	integer Hel1, Hel2, Hel3
	equivalence (Hel(1), Hel1)
	equivalence (Hel(2), Hel2)
	equivalence (Hel(3), Hel3)

	data MatSUN /1*bogus/
* hdd-END VARDECL

#include "inline.h"

* hdd-BEGIN INVARIANTS
* hdd-END INVARIANTS

* hdd-BEGIN ABBR_S
	call hdd_abbr0s
	call hdd_abbr1s
* hdd-END ABBR_S

* hdd-BEGIN ABBR_ANGLE
* hdd-END ABBR_ANGLE

* hdd-BEGIN RES_INI
	result(1) = 0
	result(2) = 0
* hdd-END RES_INI

* hdd-BEGIN HEL_LOOPS

	LOOP_HEL(Hel2)
	TEST(helicities, BIT_HEL(2))

	Hel3 = Hel2

	call hdd_SquaredMEHel(result)

	ENDTEST(helicities, BIT_HEL(2))
	ENDLOOP_HEL(Hel2)

* hdd-END HEL_LOOPS

#ifdef CHECK
	print *, 'tree =', result(1)
	print *, 'loop =', result(2)
	stop
#endif

* hdd-END SQUAREDME
	end

